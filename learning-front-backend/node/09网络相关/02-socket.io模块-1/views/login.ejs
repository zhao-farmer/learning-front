<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        // 拦截器配置

        // request 拦截
        axios.interceptors.request.use(
            function (config) {
                console.log("请求发出前，执行的方法");
                return config;
            },
            function (error) {
                return Promise.reject(error);
            }
        );

        // response 拦截
        axios.interceptors.response.use(
            function (response) {
                console.log("请求成功后，第一个调用的方法");
                
                // 获取token，后端返给前端在headers中的，都转为小写
                const {authorization} = response.headers
                // 保存到本地
                authorization && localStorage.setItem("token",authorization)
                return response;
            },
            function (error) {
                   return Promise.reject(error);
            }
        );
    </script>
</head>
<body>
    <h1>登录页面</h1>

    <div>
        <div>用户名：<input id="username" /></div>
        <div>密码：<input type="password" id="password" /></div>
        <div><button id="login">登录</button></div>
    </div>

    <script>
        var username = document.querySelector("#username");
        var password = document.querySelector("#password");
        var login = document.querySelector("#login");

        login.onclick = () => {
            console.log(username.value, password.value);

            axios.post("/api/login", {
                    username: username.value,
                    password: password.value,
            }).then(res => {
                console.log(res.data);
                if (res.data.ok === 1) {
                    localStorage.setItem("user",username.value)
                    location.href = "/chat";
                } else {
                    console.log("用户名密码不匹配");
                }
            });
        };
    </script>
</body>
</html>
